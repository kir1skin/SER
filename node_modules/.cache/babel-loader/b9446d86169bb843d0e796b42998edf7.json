{"ast":null,"code":"import coinsmall from\"../images/coinsmall.webp\";import claim from\"../images/claim.webp\";import{useEffect,useState}from\"react\";import{db}from\"../firebase\";import{collection,getDoc,getDocs,updateDoc,doc,setDoc}from\"firebase/firestore\";import{useUser}from\"../context/userContext\";// import { EnergyContext } from \"../context/EnergyContext\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";const TaskOne=_ref=>{let{showModal,setShowModal}=_ref;const{id,balance,setBalance,taskCompleted,setTaskCompleted}=useUser();const[isVerified,setIsVerified]=useState(false);const[showCheckButton,setShowCheckButton]=useState(false);const[showDoneButton,setShowDoneButton]=useState(false);const[message,setMessage]=useState(\"\");const[showTaskButton,setShowTaskButton]=useState(true);const[counter,setCounter]=useState(null);const[intervalId,setIntervalId]=useState(null);const taskID=\"task_3100\";// Assign a unique ID to this task\nconst[openComplete,setOpenComplete]=useState(false);const[isMissionButtonDisabled,setIsMissionButtonDisabled]=useState(true);useEffect(()=>{const handleBackButtonClick=()=>{setShowModal(false);document.getElementById(\"footermain\").style.zIndex=\"\";};if(showModal){window.Telegram.WebApp.BackButton.show();window.Telegram.WebApp.BackButton.onClick(handleBackButtonClick);}else{window.Telegram.WebApp.BackButton.hide();window.Telegram.WebApp.BackButton.offClick(handleBackButtonClick);}// Cleanup handler when component unmounts\nreturn()=>{window.Telegram.WebApp.BackButton.offClick(handleBackButtonClick);};},[showModal,setShowModal]);useEffect(()=>{if(id){checkTaskCompletion(id,taskID).then(completed=>{setTaskCompleted(completed);if(completed){setMessage(\"\");setIsMissionButtonDisabled(false);}});}// eslint-disable-next-line\n},[]);const handleTaskLinkClick=()=>{window.open(\"https://t.me/plutotapofficials\");setTimeout(()=>{setShowTaskButton(false);},2000);setTimeout(()=>{setShowCheckButton(true);},2000);};const handleVerify=async()=>{// Clear any existing interval\nif(intervalId){clearInterval(intervalId);}const response=await fetch(\"https://api.telegram.org/bot7327868388:AAH89ye-KeNy0TcsWFe-ixgXFXKOSRwYDj8/getChatMember?chat_id=-1002227548826&user_id=\".concat(id));const data=await response.json();if(data.ok&&(data.result.status===\"member\"||data.result.status===\"administrator\"||data.result.status===\"creator\")){setIsVerified(true);setCounter(15);setTimeout(()=>{setShowDoneButton(true);},3000);setTimeout(()=>{setShowCheckButton(false);setMessage(\"\");setIsMissionButtonDisabled(false);},3000);}else{setTimeout(()=>{setMessage(\"Please join the Telegram channel first before you can claim this task bonus.\");},1000);setCounter(15);const newIntervalId=setInterval(()=>{setCounter(prevCounter=>{if(prevCounter===1){clearInterval(newIntervalId);setShowCheckButton(false);setShowTaskButton(true);setCounter(null);}return prevCounter-1;});},2000);setIntervalId(newIntervalId);}};const checkTaskCompletion=async(id,taskId)=>{try{const userTaskDocRef=doc(db,\"userTasks\",\"\".concat(id,\"_\").concat(taskId));const docSnap=await getDoc(userTaskDocRef);if(docSnap.exists()){return docSnap.data().completed;}else{return false;}}catch(e){console.error(\"Error checking task completion: \",e);return false;}};const saveTaskCompletionToFirestore=async(id,taskId,isCompleted)=>{try{const userTaskDocRef=doc(db,\"userTasks\",\"\".concat(id,\"_\").concat(taskId));await setDoc(userTaskDocRef,{userId:id,taskId:taskId,completed:isCompleted},{merge:true});// console.log('Task completion status saved to Firestore.');\n}catch(e){console.error(\"Error saving task completion status: \",e);}};const updateUserCountInFirestore=async(id,newBalance)=>{try{const userRef=collection(db,\"telegramUsers\");const querySnapshot=await getDocs(userRef);let userDocId=null;querySnapshot.forEach(doc=>{if(doc.data().userId===id){userDocId=doc.id;}});if(userDocId){const userDocRef=doc(db,\"telegramUsers\",userDocId);await updateDoc(userDocRef,{balance:newBalance});// console.log('User count updated in Firestore.');\n}else{console.error(\"User document not found.\");}}catch(e){console.error(\"Error updating user count in Firestore: \",e);}};const finishMission=async()=>{setShowModal(false);setOpenComplete(false);document.getElementById(\"congrat\").style.opacity=\"1\";document.getElementById(\"congrat\").style.visibility=\"visible\";setTimeout(()=>{document.getElementById(\"congrat\").style.opacity=\"0\";document.getElementById(\"congrat\").style.visibility=\"invisible\";},2000);if(isVerified){const newCount=balance+50000;setBalance(newCount);setMessage(\"\");setIsMissionButtonDisabled(true);// Optionally disable the button again after mission completion\nawait saveTaskCompletionToFirestore(id,taskID,true);// Update the user's count in Firestore\nawait updateUserCountInFirestore(id,newCount);setTaskCompleted(true);}else{setMessage(\"Please verify the task first.\");}};const handleComplete=()=>{setOpenComplete(true);document.getElementById(\"footermain\").style.zIndex=\"\";};return/*#__PURE__*/_jsx(_Fragment,{children:showModal?/*#__PURE__*/_jsx(\"div\",{className:\"fixed z-50 left-0 right-0 top-0 bottom-0 flex justify-center taskbg px-[16px] h-full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex flex-col items-center justify-start\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-start py-2\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex w-full flex-col\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-[20px] font-semibold\",children:\"Join Our Socials\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-[#9a96a6] text-[16px] font-medium pt-1 pb-10\",children:\"Join our social page to get regular updates about this airdrop bot and its great potentials\"}),/*#__PURE__*/_jsx(\"p\",{className:\"w-full text-center text-[14px] font-semibold text-[#49ee49] pb-4\",children:taskCompleted?\"Task is Completed\":\"\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-cards rounded-[10px] p-[14px] flex justify-between items-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-1 items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"\",children:/*#__PURE__*/_jsx(\"img\",{src:coinsmall,className:\"w-[50px]\",alt:\"Coin Icon\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col space-y-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Reward\"}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"50 000\"})})]})]})}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-[20px] font-semibold pt-6 pb-4 px-2\",children:\"Your Tasks\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-cards rounded-[10px] p-[14px] flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-1 items-center space-x-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col space-y-1\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-semibold\",children:\"Join the Telegram Channel\"}),message&&/*#__PURE__*/_jsx(\"span\",{className:\"text-[#ea5b48] text-[12px] pr-8\",children:message})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"\",children:[taskCompleted?/*#__PURE__*/_jsx(_Fragment,{}):/*#__PURE__*/_jsx(_Fragment,{children:showTaskButton&&/*#__PURE__*/_jsx(\"button\",{onClick:handleTaskLinkClick,className:\"flex font-medium bg-btn hover:bg-[#1e3356] ease-in duration-300 py-[6px] px-4 rounded-[8px] items-center justify-center text-[16px]\",children:\"Go\"})}),showCheckButton&&/*#__PURE__*/_jsxs(\"button\",{onClick:handleVerify,className:\"flex font-medium bg-btn py-[6px] px-4 rounded-[8px] items-center justify-center text-[16px]\",children:[/*#__PURE__*/_jsx(\"span\",{children:\" Check\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-[#b0b0b0] pointer-events-none select-none\",children:counter!==null&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-[#fff]\",children:\"ing\"}),\" \".concat(counter,\"s\")]})})]}),showDoneButton&&/*#__PURE__*/_jsx(\"button\",{id:\"done\",className:\"text-[#7cf47c] font-medium py-[6px] px-4 rounded-[8px] items-center justify-center text-[16px]\",children:\"Done\"}),taskCompleted&&/*#__PURE__*/_jsx(_Fragment,{})]})]}),taskCompleted?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"button\",{className:\"my-6 w-full py-5 px-3 flex items-center rounded-[12px] justify-center text-center text-[20px] font-medium text-[#6a6978] bg-btn2\",children:\"Mission Completed\"})}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleComplete(true),disabled:isMissionButtonDisabled,className:\"my-6 w-full py-5 px-3 flex items-center rounded-[12px] justify-center text-center text-[20px] font-medium \\n                                    \".concat(isMissionButtonDisabled?\"text-[#6a6978] bg-btn2\":\"text-[#f4f4f4] bg-btn\"),children:\"Finish Mission\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"\".concat(openComplete===true?\"visible\":\"invisible\",\" absolute bottom-0 left-0 right-0 h-[76vh] bg-[#1e2340f7] z-[100] rounded-tl-[20px] rounded-tr-[20px] flex justify-center px-4 py-5\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex flex-col justify-between py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-full flex justify-center flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-[120px] h-[120px] rounded-[14px] bg-[#252e57] flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"img\",{alt:\"claim\",src:claim,className:\"\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-[28px] py-4\",children:\"Congratulations\"}),/*#__PURE__*/_jsx(\"p\",{className:\"pb-6 text-[#9a96a6] text-[16px]\",children:\"You have successfully completed the mission\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-1 items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"\",children:/*#__PURE__*/_jsx(\"img\",{src:coinsmall,className:\"w-[25px]\",alt:\"Coin Icon\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"font-bold text-[20px]\",children:\"50 000\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full flex justify-center pb-12\",children:/*#__PURE__*/_jsx(\"button\",{onClick:finishMission,className:\"bg-gradient-to-b gradient from-[#ffba4c] to-[#aa6900] w-full py-5 px-3 flex items-center justify-center text-center rounded-[12px] font-semibold text-[22px]\",children:\"Claim\"})})]})})]})}):null});};export default TaskOne;","map":null,"metadata":{},"sourceType":"module"}